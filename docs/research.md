# ピッチ検出アルゴリズム研究

## 現在の実装

このプロジェクトは現在**Pitchy**ライブラリを使用しており、以下を実装しています：
- 自己相関ベースのピッチ検出
- NSDF（正規化平方差関数）
- Webブラウザ向けリアルタイム性能最適化

## リアルタイムピッチ検出の代替アルゴリズム

### 1. YINアルゴリズム
**利点:**
- NSFDの改良版で基本周波数検出精度が向上
- 差分関数を使用してピッチの曖昧性を削減
- 楽器音に対して特に高精度
- 研究によると精度と速度の最適なバランス

**欠点:**
- 自己相関より計算コストが高い
- 40Hz検出には最低50msの解析窓が必要（理論的制限）
- 初期値が不安定になることがある
- 時々異常に間違った値を出力

### 2. PYIN（確率的YIN）
**利点:**
- YINの確率的拡張
- 複数の候補周波数を確率で評価
- 高いノイズ耐性
- 不確実なピッチ領域の処理が改善

**欠点:**
- YINより計算集約的
- 実装が複雑
- JavaScript実装が限定的

### 3. SWIPE（のこぎり波インスパイア型ピッチ推定器）
**利点:**
- スペクトル領域での処理
- 非常に高い精度と安定性
- ノイズの多い信号に対して良好な性能

**欠点:**
- 計算コストが高い
- 実装がより複雑
- 時間領域手法より遅い

### 4. OBP（1ビットピッチ）
**利点:**
- 超高速：代替手法の9倍、SWIPEの50倍高速
- 平均処理時間：4.6ms（リアルタイムの0.046倍）
- 1ビット量子化と修正自己相関ベース

**欠点:**
- 非常に新しいアルゴリズム（2023年研究）
- 実世界でのテストが限定的
- 成熟したJavaScript実装がまだない

## リアルタイム性能の考慮事項

### 現在のPitchy性能:
- FFTサイズ：4096サンプル
- 解析部分：4（各1024サンプル）
- サンプリングレート：44.1kHz
- 処理遅延：解析窓あたり約93ms

### YIN性能特性:
- 検出には最低2ピッチ周期が必要
- 40Hz検出には≥50ms解析窓が必要
- リアルタイム実装の課題：
  - 初期値の不安定性
  - ストリーミング処理の最適化が必要
  - 連続動作のためのメモリ管理

## 実装推奨事項

### 選択肢1: YINへのアップグレード
**利点:**
- 大幅な精度向上
- 成熟したJavaScript実装が利用可能
- よく文書化されたアルゴリズム

**欠点:**
- 計算コストの増加
- 初期不安定性の対処が必要
- 遅延増加の可能性

### 選択肢2: ハイブリッドアプローチ
**利点:**
- リアルタイム表示に高速自己相関を使用
- 高精度チューニングフィードバックにYINを使用
- 両方の利点を活用

**欠点:**
- コードの複雑性
- 二重処理のオーバーヘッド

### 選択肢3: 現在の実装を維持
**利点:**
- 現在のアプリケーションでの実証済み性能
- 低遅延
- 簡単な保守

**欠点:**
- 精度向上の可能性が限定的
- 複雑な音声信号に対する堅牢性が低い

## 技術実装メモ

### 必要な性能ベンチマーク:
- 楽器音サンプルでの精度比較
- リアルタイム性能測定
- メモリ使用量解析
- モバイルデバイスでのバッテリー影響

## 結論

YINアルゴリズムは、リアルタイム性能を維持しながら実証済みの精度向上を提供する最良の即座アップグレード経路です。

最大性能要件に対しては、OBPが有望ですが成熟した実装が不足しています。YIN統合から始める段階的アプローチは、システム安定性を維持しながら測定可能な改善を提供するでしょう。
